(()=>{"use strict";var t={300:(t,e)=>{var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();t.exports=e=n.fetch,n.fetch&&(e.default=n.fetch.bind(n)),e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={exports:{}};return t[o](r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{const t=function(){function t(){this.state="idle",this.hasGround=!0,this.speed=0,this.inertion=0,this.eDown=0,this.mass=0,this.hasCollision=!0,this.id=Math.random().toString(16).slice(2)}return t.prototype.draw=function(t){var e=this.faced,n=this.sprites[this.state],o=n.image[e],i=this.height/o.height,r=o.width*i/n.max,a=this.x-r/2,c=this.y-s.target.height/2;t.drawImage(o,o.width/n.max*Math.floor(n.cur),0,o.width/n.max,o.height,a,c,o.width*i/n.max,this.height),n.update()},t}(),e=new(function(){function t(){this.a=!1,this.d=!1,this.space=!1}return t.prototype.setMaster=function(t){this.master=t},t.prototype.removeMaster=function(){this.master=void 0},t.prototype.setSlave=function(t){this.slave=t},t.prototype.removeSlave=function(){this.slave=void 0},t.prototype.updateState=function(){this.a=void 0!==this.master.getKey("KeyA"),this.d=void 0!==this.master.getKey("KeyD"),this.space=void 0!==this.master.getKey("Space")},t.prototype.update=function(){void 0!==this.master&&void 0!==this.slave&&(this.a&&this.slave.hasGround&&(this.slave.faced=0,this.slave.inertion=-this.slave.speed),this.d&&this.slave.hasGround&&(this.slave.faced=1,this.slave.inertion=this.slave.speed),this.space&&this.slave.hasGround&&(this.slave.eDown=-10,this.slave.hasGround=!1,this.slave.state="jump"))},t}());var o=function(){function t(){var t=this;this.virtualKeys={},document.addEventListener("keydown",(function(e){return t.codeReaction(e.code,!0,e)})),document.addEventListener("keyup",(function(e){return t.codeReaction(e.code,!1,e)}))}return t.prototype.getKey=function(t){return this.virtualKeys[t]},t.prototype.attach=function(t){e.setMaster(this),e.setSlave(t),this.slave=e},t.prototype.unAttach=function(){e.removeMaster(),e.removeSlave(),this.slave=void 0},t.prototype.codeReaction=function(t,e,n){e?this.virtualKeys[t]=n:delete this.virtualKeys[t],this.slave&&this.slave.updateState()},t}();const i=new o;const r=window.requestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)},a=new(function(){function t(){this.objects=[],this.lastTime=(new Date).valueOf()}return t.prototype.addObject=function(t){this.objects.push(t)},t.prototype.removeObject=function(t){this.objects.includes(t)&&this.objects.splice(this.objects.indexOf(t),1)},t.prototype.start=function(){var t=this,n=this.objects,o=function(){e.update();var i=(new Date).valueOf()-t.lastTime;n.map((function(e){e.eDown+=e.mass;var n,o=0,r=0,a=[];o=e.y+e.eDown,n={left:r=e.x,top:o,right:r+e.width,bottom:o+e.height},0===(a=t.checkCollision(n,e.id)).length?(e.y+=e.eDown,e.state="fall"):(e.y=a[0].top-e.height,e.eDown=0,e.hasGround=!0,e.state="idle"),o=e.y,n={left:r=e.x+e.inertion*i,top:o,right:r+e.width,bottom:o+e.height},0===(a=t.checkCollision(n,e.id)).length?(e.state="run",e.x+=e.inertion*i,e.hasGround&&(e.inertion-=.7*e.inertion)):e.inertion=0,Math.abs(e.inertion)<.001&&(e.inertion=0),0===e.inertion&&"fall"!==e.state&&(e.state="idle")})),r(o),t.lastTime=(new Date).valueOf()};o()},t.prototype.checkCollision=function(t,e){return void 0===e&&(e=""),this.objects.map((function(n){if(n.id!==e&&n.hasCollision)return o={left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height},(i=t).left>=o.right||i.right<=o.left||i.top>=o.bottom||i.bottom<=o.top?void 0:{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height};var o,i})).filter((function(t){return t}))},t}()),s=new(function(){function e(){this.customAttach=!1}return Object.defineProperty(e.prototype,"target",{get:function(){return this.attached},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return null==this?void 0:this.attached.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return null==this?void 0:this.attached.y},enumerable:!1,configurable:!0}),e.prototype.virtualAttach=function(){this.attached=function(e,n){void 0===e&&(e=100),void 0===n&&(n=100);var o=new t;return o.x=e,o.y=n,o.width=1,o.height=1,o.speed=1,o.hasCollision=!1,o}(),this.customAttach=!0,i.attach(this.attached),a.addObject(this.attached)},e.prototype.attach=function(t){t instanceof o?this.virtualAttach():this.attached=t},e.prototype.unAttach=function(){this.customAttach&&(i.unAttach(),a.removeObject(this.attached),this.customAttach=!1),this.attached=void 0},e}());var c=n(300),u=n.n(c);const h=new(function(){function t(){this.resourceMap={}}return t.prototype.load=function(t){return e=this,n=void 0,i=function(){var e,n,o=this;return function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}(this,(function(i){switch(i.label){case 0:return[4,u()(t).then((function(t){return t.json()}))];case 1:return e=i.sent(),n=[],e.map((function(t){n.push(new Promise((function(e){var n=new Image;n.src="resources/"+t,n.onload=function(){e([t,n])}})))})),[4,Promise.all(n)];case 2:return i.sent().map((function(t){var e=t[0];o.resourceMap[e]=t[1]})),[2]}}))},new((o=void 0)||(o=Promise))((function(t,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(a,s)}c((i=i.apply(e,n||[])).next())}));var e,n,o,i},t.prototype.get=function(t){return this.resourceMap[t]},t}()),l=function(){function t(t,e,n){this.cur=0,this.speed=n,this.max=t,this.image=[];var o=h.get(e);this.image[1]=o;var i=document.createElement("canvas");i.width=o.width,i.height=o.height;var r=i.getContext("2d");r.scale(-1,1),r.translate(-o.width,0),r.drawImage(o,0,0),this.image[0]=i}return t.prototype.update=function(){this.cur+=this.speed,this.cur>this.max&&(this.cur=0)},t}();var p,d=(p=function(t,e){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},p(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});const f=function(t){function e(e,n){var o=t.call(this)||this;return o.faced=1,o.sprites={idle:new l(12,"idle.png",.3),run:new l(8,"run.png",.2),jump:new l(1,"jump.png",0),fall:new l(2,"fall.png",.1),landing:new l(1,"landing.png",0)},o.x=e,o.y=n,o.height=165,o.width=100,o.speed=.25,o.mass=.5,o.hasGround=!1,o}return d(e,t),e}(t),y=function(){function t(){this.items=[]}return Object.defineProperty(t.prototype,"objects",{get:function(){return this.items},enumerable:!1,configurable:!0}),t.prototype.addObject=function(t){this.items.push(t)},t}(),v=function(){var t=b.canvas.getBoundingClientRect(),e=t.width,n=t.height;b.width=e,b.height=n},w=function(){function t(){this.postCb=[]}return t.prototype.add=function(t){this.postCb.push((function(e){return t(e)}))},t.prototype.postWork=function(t){this.postCb.map((function(e){return e(t)}))},t}();var g=new(function(){function t(){this.parallax=new y,this.layers=[],this.addons=new w}return Object.defineProperty(t.prototype,"height",{get:function(){return this.display.height},set:function(t){this.display.height=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.display.width},set:function(t){this.display.width=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvas",{get:function(){return this.display},enumerable:!1,configurable:!0}),t.prototype.attach=function(t){this.display=document.getElementById(t),v(),this.scene=this.display.getContext("2d")},t.prototype.addParallax=function(t){this.parallax.addObject(t)},t.prototype.addObject=function(t,e){var n=this.layers;void 0===n[e]&&(n[e]=new y),n[e].addObject(t)},t.prototype.startDrawing=function(){var t=this,e=t.scene,n=t.parallax,o=t.layers,i=t.addons;e.imageSmoothingEnabled=!1,e.fillStyle="#000";var a=function(){n.objects.map((function(t){return t.draw(e)})),e.translate(g.width/2,g.height/2),e.translate(-s.x,-s.y),o.map((function(t){t.objects.map((function(t){return t.draw(e)}))})),e.resetTransform(),i.postWork(e),r(a)};a()},t}());const b=g;var m=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const x=function(t){function e(e,n){var o=t.call(this)||this;return o.fon=new Image,o.fon.src=e,o.bias=n,o}return m(e,t),e.prototype.draw=function(t){var e=this.fon,n=b.height/e.height,o=s.x*(this.bias/10)%(e.width*n);t.drawImage(e,0,0,e.width,e.height,-o-e.width*n,0,e.width*n,b.height),t.drawImage(e,0,0,e.width,e.height,-o,0,e.width*n,b.height),t.drawImage(e,0,0,e.width,e.height,-o+e.width*n,0,e.width*n,b.height),t.drawImage(e,0,0,e.width,e.height,-o+e.width*n*2,0,e.width*n,b.height)},e}(t);var j=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const O=function(t){function e(e,n){var o=t.call(this)||this;return o.faced=1,o.sprites={idle:new l(1,"block.png",0)},o.x=e,o.y=n,o.height=100,o.width=100,o}return j(e,t),e}(t);var _=0,P=0;setInterval((function(){P=_,_=0}),1e3);const S=function(t){_++,t.fillText(P.toString(),20,20)};document.addEventListener("DOMContentLoaded",(function(){return t=void 0,e=void 0,o=function(){var t,e,n,o,r,c,u,l;return function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}(this,(function(p){switch(p.label){case 0:return[4,h.load("/resource.json")];case 1:for(p.sent(),t=new x("resources/plx-1.png",1),b.addParallax(t),e=new x("resources/plx-2.png",2),b.addParallax(e),n=new x("resources/plx-3.png",3),b.addParallax(n),o=new x("resources/plx-4.png",4),b.addParallax(o),r=new x("resources/plx-5.png",5),b.addParallax(r),c=0;c<100;c++)u=new O(50+250*c,300),b.addObject(u,1),a.addObject(u);return l=new f(100,100),b.addObject(l,1),a.addObject(l),i.attach(l),s.attach(l),b.attach("display"),b.addons.add(S),b.startDrawing(),a.start(),window.addEventListener("resize",(function(){v()})),[2]}}))},new((n=void 0)||(n=Promise))((function(i,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}));var t,e,n,o}))})()})();
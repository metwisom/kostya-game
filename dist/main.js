(()=>{"use strict";const t=function(){function t(){this.state="idle",this.hasGround=!0,this.speed=0,this.inertion=0,this.eDown=0,this.mass=0,this.hasCollision=!0,this.id=Math.random().toString(16).slice(2)}return t.prototype.draw=function(t){var e=this.faced,n=this.sprites[this.state],i=n.image[e],o=this.height/i.height,r=i.width*o/n.max,s=this.x-r/2,h=this.y-a.target.height/2;t.drawImage(i,i.width/n.max*Math.floor(n.cur),0,i.width/n.max,i.height,s,h,i.width*o/n.max,this.height),n.update()},t}(),e=new(function(){function t(){this.a=!1,this.d=!1,this.space=!1}return t.prototype.setMaster=function(t){this.master=t},t.prototype.removeMaster=function(){this.master=void 0},t.prototype.setSlave=function(t){this.slave=t},t.prototype.removeSlave=function(){this.slave=void 0},t.prototype.updateState=function(){this.a=void 0!==this.master.getKey("KeyA"),this.d=void 0!==this.master.getKey("KeyD"),this.space=void 0!==this.master.getKey("Space")},t.prototype.update=function(){void 0!==this.master&&void 0!==this.slave&&(this.a&&this.slave.hasGround&&(this.slave.faced=0,this.slave.inertion=-this.slave.speed),this.d&&this.slave.hasGround&&(this.slave.faced=1,this.slave.inertion=this.slave.speed),this.space&&this.slave.hasGround&&(this.slave.eDown=-10,this.slave.hasGround=!1,this.slave.state="jump"))},t}());var n=function(){function t(){var t=this;this.virtualKeys={},document.addEventListener("keydown",(function(e){return t.codeReaction(e.code,!0,e)})),document.addEventListener("keyup",(function(e){return t.codeReaction(e.code,!1,e)}))}return t.prototype.getKey=function(t){return this.virtualKeys[t]},t.prototype.attach=function(t){e.setMaster(this),e.setMaster(void 0),e.setSlave(t),this.slave=e},t.prototype.unAttach=function(){e.removeMaster(),e.removeSlave(),this.slave=void 0},t.prototype.codeReaction=function(t,e,n){e?this.virtualKeys[t]=n:delete this.virtualKeys[t],this.slave&&this.slave.updateState()},t}();const i=new n;const o=window.requestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)},r=new(function(){function t(){this.objects=[],this.lastTime=(new Date).valueOf()}return t.prototype.addObject=function(t){this.objects.push(t)},t.prototype.removeObject=function(t){this.objects.includes(t)&&this.objects.splice(this.objects.indexOf(t),1)},t.prototype.start=function(){var t=this,n=this.objects,i=function(){e.update();var r=(new Date).valueOf()-t.lastTime;n.map((function(e){e.eDown+=e.mass;var n,i=0,o=0,a=[];i=e.y+e.eDown,n={left:o=e.x,top:i,right:o+e.width,bottom:i+e.height},0===(a=t.checkCollision(n,e.id)).length?(e.y+=e.eDown,e.state="fall"):(e.y=a[0].top-e.height,e.eDown=0,e.hasGround=!0,e.state="idle"),i=e.y,n={left:o=e.x+e.inertion*r,top:i,right:o+e.width,bottom:i+e.height},0===(a=t.checkCollision(n,e.id)).length?(e.state="run",e.x+=e.inertion*r,e.hasGround&&(e.inertion-=.7*e.inertion)):e.inertion=0,Math.abs(e.inertion)<.001&&(e.inertion=0),0===e.inertion&&"fall"!==e.state&&(e.state="idle")})),o(i),t.lastTime=(new Date).valueOf()};i()},t.prototype.checkCollision=function(t,e){return void 0===e&&(e=""),this.objects.map((function(n){if(n.id!==e&&n.hasCollision)return i={left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height},(o=t).left>=i.right||o.right<=i.left||o.top>=i.bottom||o.bottom<=i.top?void 0:{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height};var i,o})).filter((function(t){return t}))},t}()),a=new(function(){function e(){this.customAttach=!1}return Object.defineProperty(e.prototype,"target",{get:function(){return this.attached},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return null==this?void 0:this.attached.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return null==this?void 0:this.attached.y},enumerable:!1,configurable:!0}),e.prototype.virtualAttach=function(){this.attached=function(e,n){void 0===e&&(e=100),void 0===n&&(n=100);var i=new t;return i.x=e,i.y=n,i.width=1,i.height=1,i.speed=1,i.hasCollision=!1,i}(),this.customAttach=!0,i.attach(this.attached),r.addObject(this.attached)},e.prototype.attach=function(t){t instanceof n?this.virtualAttach():this.attached=t},e.prototype.unAttach=function(){this.customAttach&&(i.unAttach(),r.removeObject(this.attached),this.customAttach=!1),this.attached=void 0},e}()),s=function(){function t(t,e,n){var i=this;this.cur=0,this.speed=n,this.max=t,this.image=[];var o=new Image;o.src="resources/"+e,o.onload=function(){i.image[1]=o;var t=document.createElement("canvas");t.width=o.width,t.height=o.height;var e=t.getContext("2d");e.scale(-1,1),e.translate(-o.width,0),e.drawImage(o,0,0),i.image[0]=t}}return t.prototype.update=function(){this.cur+=this.speed,this.cur>this.max&&(this.cur=0)},t}();var h,c=(h=function(t,e){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},h(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});const u=function(t){function e(e,n){var i=t.call(this)||this;return i.faced=1,i.sprites={idle:new s(12,"idle.png",.3),run:new s(8,"run.png",.2),jump:new s(1,"jump.png",0),fall:new s(2,"fall.png",.1),landing:new s(1,"landing.png",0)},i.x=e,i.y=n,i.height=165,i.width=100,i.speed=.25,i.mass=.5,i.hasGround=!1,i}return c(e,t),e}(t),d=function(){function t(){this.items=[]}return Object.defineProperty(t.prototype,"objects",{get:function(){return this.items},enumerable:!1,configurable:!0}),t.prototype.addObject=function(t){this.items.push(t)},t}(),p=function(){var t=y.canvas.getBoundingClientRect(),e=t.width,n=t.height;y.width=e,y.height=n},l=function(){function t(){this.postCb=[]}return t.prototype.add=function(t){this.postCb.push((function(e){return t(e)}))},t.prototype.postWork=function(t){this.postCb.map((function(e){return e(t)}))},t}();var f=new(function(){function t(){this.parallax=new d,this.layers=[],this.addons=new l}return Object.defineProperty(t.prototype,"height",{get:function(){return this.display.height},set:function(t){this.display.height=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.display.width},set:function(t){this.display.width=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvas",{get:function(){return this.display},enumerable:!1,configurable:!0}),t.prototype.attach=function(t){this.display=document.getElementById(t),p(),this.scene=this.display.getContext("2d")},t.prototype.addParallax=function(t){this.parallax.addObject(t)},t.prototype.addObject=function(t,e){var n=this.layers;void 0===n[e]&&(n[e]=new d),n[e].addObject(t)},t.prototype.startDrawing=function(){var t=this,e=t.scene,n=t.parallax,i=t.layers,r=t.addons;e.imageSmoothingEnabled=!1,e.fillStyle="#000";var s=function(){n.objects.map((function(t){return t.draw(e)})),e.translate(f.width/2,f.height/2),e.translate(-a.x,-a.y),i.map((function(t){t.objects.map((function(t){return t.draw(e)}))})),e.resetTransform(),r.postWork(e),o(s)};s()},t}());const y=f;var v=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();const g=function(t){function e(e,n){var i=t.call(this)||this;return i.fon=new Image,i.fon.src=e,i.bias=n,i}return v(e,t),e.prototype.draw=function(t){var e=this.fon,n=y.height/e.height,i=a.x*(this.bias/10)%(e.width*n);t.drawImage(e,0,0,e.width,e.height,-i-e.width*n,0,e.width*n,y.height),t.drawImage(e,0,0,e.width,e.height,-i,0,e.width*n,y.height),t.drawImage(e,0,0,e.width,e.height,-i+e.width*n,0,e.width*n,y.height),t.drawImage(e,0,0,e.width,e.height,-i+e.width*n*2,0,e.width*n,y.height)},e}(t);var w=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();const m=function(t){function e(e,n){var i=t.call(this)||this;return i.faced=1,i.sprites={idle:new s(1,"block.png",0)},i.x=e,i.y=n,i.height=100,i.width=100,i}return w(e,t),e}(t);var b=0,x=0;setInterval((function(){x=b,b=0}),1e3);const j=function(t){b++,t.fillText(x.toString(),20,20)};document.addEventListener("DOMContentLoaded",(function(){y.attach("display"),y.addons.add(j),y.startDrawing(),r.start(),window.addEventListener("resize",(function(){p()}))}));var O=new g("resources/plx-1.png",1);y.addParallax(O);var _=new g("resources/plx-2.png",2);y.addParallax(_);var P=new g("resources/plx-3.png",3);y.addParallax(P);var C=new g("resources/plx-4.png",4);y.addParallax(C);var A=new g("resources/plx-5.png",5);y.addParallax(A);for(var S=0;S<100;S++){var D=new m(50+250*S,300);y.addObject(D,1),r.addObject(D)}var E=new u(100,100);y.addObject(E,1),r.addObject(E),i.attach(E),a.attach(i)})();